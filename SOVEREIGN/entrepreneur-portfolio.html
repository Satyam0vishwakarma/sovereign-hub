<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Founder Command | Sovereign Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;700;800;900&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <link rel="stylesheet" href="css/dashboard.css">
    <style>
        /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
        .trinity-nav {
            background: var(--shark-obsidian);
            height: 76px; display: grid;
            grid-template-columns: 240px 1fr 240px;
            align-items: center; padding: 0 40px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            position: sticky; top: 0; z-index: 5000;
        }
        .nav-left  { display:flex; justify-content:flex-start; }
        .nav-right { display:flex; justify-content:flex-end; align-items:center; gap:16px; }
        .nav-center { display:flex; justify-content:center; }
        .central-statement { color:white; font-weight:800; text-transform:uppercase; letter-spacing:6px; font-size:0.65rem; opacity:0.5; text-align:center; }

        .btn-return {
            background: rgba(255,255,255,0.05); border: 1.5px solid rgba(255,255,255,0.1);
            color:#94a3b8; text-decoration:none; padding:10px 20px; border-radius:12px;
            font-size:0.75rem; font-weight:800; text-transform:uppercase; letter-spacing:1px; transition:.3s;
        }
        .btn-return:hover { background:var(--shark-indigo); color:white; transform:translateX(-4px); }

        .cosmic-node { width:40px; height:40px; position:relative; display:flex; align-items:center; justify-content:center; cursor:pointer; }
        .star-core   { width:9px; height:9px; background:white; border-radius:50%; box-shadow:0 0 12px #fff, 0 0 24px var(--shark-indigo); z-index:5; }
        .orbit-ring  { position:absolute; width:100%; height:100%; border:1px solid rgba(99,102,241,0.3); border-radius:50%; animation:spin 10s linear infinite; }
        @keyframes spin { to { transform:rotate(360deg); } }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        .page-header {
            background: var(--shark-obsidian);
            background-image:
                radial-gradient(ellipse at 90% 10%, rgba(99,102,241,0.2) 0%, transparent 50%),
                radial-gradient(ellipse at 5% 90%, rgba(16,185,129,0.08) 0%, transparent 45%);
            padding: 6rem 0 11rem;
            position: relative; overflow: hidden;
        }
        .page-header::before {
            content:''; position:absolute; inset:0;
            background-image: linear-gradient(rgba(99,102,241,0.03) 1px, transparent 1px),
                              linear-gradient(90deg,rgba(99,102,241,0.03) 1px, transparent 1px);
            background-size: 52px 52px;
            mask-image: radial-gradient(ellipse at 50% 50%, black 10%, transparent 70%);
            pointer-events:none;
        }
        .header-inner-pg { max-width:1400px; margin:0 auto; padding:0 40px; display:flex; justify-content:space-between; align-items:flex-end; }
        .header-text { flex:1; }
        .header-eyebrow { font-size:.6rem; font-weight:900; letter-spacing:5px; color:var(--shark-emerald); text-transform:uppercase; margin-bottom:10px; display:block; }
        .header-h1 { font-size:3.8rem; font-weight:900; letter-spacing:-3.5px; color:white; line-height:1; margin-bottom:1rem; }
        .header-sub { color:rgba(255,255,255,0.45); font-weight:600; font-size:.9rem; max-width:440px; line-height:1.6; }

        /* Header summary pills */
        .header-pills { display:flex; gap:12px; flex-wrap:wrap; margin-top:2rem; }
        .h-pill {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 14px; padding: 14px 20px;
            text-align:center; min-width:100px;
        }
        .h-pill-val { font-size:1.4rem; font-weight:900; color:white; letter-spacing:-1px; display:block; line-height:1; }
        .h-pill-lbl { font-size:.52rem; font-weight:800; color:rgba(255,255,255,0.35); text-transform:uppercase; letter-spacing:1.5px; margin-top:5px; display:block; }
        .h-pill.green { background:rgba(16,185,129,0.12); border-color:rgba(16,185,129,0.25); }
        .h-pill.green .h-pill-val { color:#6ee7b7; }
        .h-pill.indigo { background:rgba(99,102,241,0.15); border-color:rgba(99,102,241,0.3); }
        .h-pill.indigo .h-pill-val { color:#a5b4fc; }

        /* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
        .portfolio-layout {
            max-width: 1400px;
            margin: -6rem auto 6rem;
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 2rem;
            padding: 0 20px;
        }

        /* ‚îÄ‚îÄ SECTION LABEL ‚îÄ‚îÄ */
        .section-lbl {
            font-size:.6rem; font-weight:900; text-transform:uppercase;
            letter-spacing:3px; color:#94a3b8; margin-bottom:1.2rem; display:flex;
            align-items:center; gap:10px;
        }
        .section-lbl::after { content:''; flex:1; height:1px; background:var(--shark-border); }

        /* ‚îÄ‚îÄ DEAL NODE (main card) ‚îÄ‚îÄ */
        .deal-node {
            background: white;
            border-radius: 28px;
            padding: 2.2rem;
            border: 1px solid var(--shark-border);
            box-shadow: 0 4px 24px rgba(0,0,0,0.04);
            margin-bottom: 1.2rem;
            transition: .3s cubic-bezier(0.23,1,0.32,1);
            cursor: pointer;
            text-decoration: none;
            display: block;
            color: inherit;
        }
        .deal-node:hover { transform:translateY(-5px); border-color:rgba(99,102,241,0.25); box-shadow:0 20px 40px rgba(99,102,241,0.08); }
        .deal-node:last-child { margin-bottom:0; }

        .deal-top { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1rem; }
        .deal-code { font-family:'JetBrains Mono',monospace; font-size:.6rem; font-weight:700; color:var(--shark-indigo); background:#f5f3ff; padding:4px 12px; border-radius:8px; }
        .deal-date { font-size:.62rem; color:#94a3b8; font-weight:700; }
        .deal-title { font-size:1.4rem; font-weight:900; letter-spacing:-.03em; color:var(--shark-obsidian); margin-bottom:.5rem; line-height:1.2; }
        .deal-category { font-size:.72rem; color:#64748b; font-weight:700; margin-bottom:1.2rem; }

        /* Stats row */
        .deal-stats { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:1.2rem; }
        .ds-node { background:#f8fafc; border:1px solid #f1f5f9; border-radius:16px; padding:14px; }
        .ds-node.emerald { background:#f0fdf4; border-color:#d1fae5; }
        .ds-node.indigo  { background:#f5f3ff; border-color:#e0e7ff; }
        .ds-node.gold    { background:#fefce8; border-color:#fef08a; }
        .ds-lbl { font-size:.52rem; font-weight:800; color:#94a3b8; text-transform:uppercase; letter-spacing:1.5px; display:block; margin-bottom:4px; }
        .ds-val { font-size:1.05rem; font-weight:900; color:var(--shark-obsidian); }
        .ds-node.emerald .ds-lbl { color:#059669; }
        .ds-node.emerald .ds-val { color:#065f46; }
        .ds-node.indigo  .ds-lbl { color:var(--shark-indigo); }
        .ds-node.indigo  .ds-val { color:#3730a3; }
        .ds-node.gold    .ds-lbl { color:#b45309; }
        .ds-node.gold    .ds-val { color:#92400e; }

        /* Investor strip */
        .investor-strip { display:flex; align-items:center; justify-content:space-between; background:#f8fafc; border:1px solid #f1f5f9; border-radius:14px; padding:12px 16px; }
        .inv-info { display:flex; align-items:center; gap:10px; }
        .inv-avatar { width:32px; height:32px; border-radius:50%; background:var(--shark-indigo); color:white; display:flex; align-items:center; justify-content:center; font-size:.75rem; font-weight:900; flex-shrink:0; }
        .inv-name { font-size:.85rem; font-weight:800; color:var(--shark-obsidian); }
        .inv-role { font-size:.62rem; color:#94a3b8; font-weight:700; }
        .inv-link { font-size:.7rem; font-weight:900; color:var(--shark-indigo); text-decoration:none; text-transform:uppercase; letter-spacing:1px; border-bottom:1.5px solid var(--shark-indigo); transition:.2s; }
        .inv-link:hover { color:#4f46e5; border-color:#4f46e5; }

        /* ‚îÄ‚îÄ PROPOSALS SECTION ‚îÄ‚îÄ */
        .proposal-row {
            background:white; border-radius:20px; border:1px solid var(--shark-border);
            padding:1.4rem 1.8rem; margin-bottom:10px;
            display:flex; align-items:center; justify-content:space-between; gap:1rem;
            transition:.2s; cursor:pointer; text-decoration:none; color:inherit;
        }
        .proposal-row:hover { border-color:rgba(99,102,241,0.2); box-shadow:0 8px 20px rgba(0,0,0,0.05); transform:translateX(4px); }
        .pr-title { font-size:.95rem; font-weight:800; color:var(--shark-obsidian); margin-bottom:3px; }
        .pr-meta  { font-size:.7rem; color:#64748b; font-weight:600; }
        .pr-badges { display:flex; gap:6px; align-items:center; flex-shrink:0; }
        .pr-badge { padding:4px 12px; border-radius:20px; font-size:.62rem; font-weight:800; text-transform:uppercase; white-space:nowrap; }
        .pr-badge.live    { background:#dcfce7; color:#15803d; border:1px solid #86efac; }
        .pr-badge.pending { background:#fef9c3; color:#854d0e; border:1px solid #fde047; }
        .pr-badge.closed  { background:#f1f5f9; color:#475569; border:1px solid #cbd5e1; }
        .pr-offers { font-size:.75rem; font-weight:800; color:var(--shark-indigo); white-space:nowrap; }

        /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
        .sidebar-card {
            background:white; border-radius:24px; padding:2rem; border:1px solid var(--shark-border);
            box-shadow:0 4px 20px rgba(0,0,0,0.03); margin-bottom:1.2rem;
        }
        .sidebar-card:last-child { margin-bottom:0; }
        .sidebar-card.sticky-sidebar { position:sticky; top:96px; }

        .sidebar-title { font-size:.6rem; font-weight:900; text-transform:uppercase; letter-spacing:3px; color:var(--shark-indigo); margin-bottom:1.2rem; }
        .stat-row { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid #f8fafc; }
        .stat-row:last-child { border-bottom:none; }
        .stat-row-label { font-size:.75rem; font-weight:700; color:#64748b; }
        .stat-row-val   { font-size:.9rem; font-weight:900; color:var(--shark-obsidian); }

        .sector-row  { display:flex; justify-content:space-between; font-size:.7rem; font-weight:800; margin-bottom:6px; color:var(--shark-muted); }
        .sector-bar  { height:5px; background:#f1f5f9; border-radius:10px; overflow:hidden; margin-bottom:14px; }
        .sector-fill { height:100%; border-radius:10px; background:linear-gradient(90deg,var(--shark-indigo),#818cf8); }

        /* tip box */
        .tip-box {
            background:linear-gradient(135deg,#020617,#1e1b4b);
            border-radius:18px; padding:1.4rem 1.6rem;
            border:1px solid rgba(99,102,241,0.2);
        }
        .tip-eyebrow { font-size:.52rem; font-weight:900; color:var(--shark-indigo); text-transform:uppercase; letter-spacing:3px; margin-bottom:.6rem; display:block; }
        .tip-text    { font-size:.8rem; font-weight:700; color:rgba(255,255,255,0.75); line-height:1.5; }
        .tip-author  { font-size:.65rem; color:rgba(255,255,255,0.3); margin-top:.5rem; display:block; font-weight:600; }

        /* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
        .empty-pg {
            grid-column:1/-1; background:white; border-radius:28px;
            border:1px solid var(--shark-border); padding:5rem; text-align:center;
            box-shadow:0 4px 20px rgba(0,0,0,0.03);
        }
        .empty-pg-icon  { font-size:3rem; margin-bottom:1rem; }
        .empty-pg-title { font-size:1.4rem; font-weight:900; letter-spacing:-.03em; color:var(--shark-obsidian); margin-bottom:.5rem; }
        .empty-pg-desc  { color:#94a3b8; font-weight:600; font-size:.85rem; margin-bottom:1.6rem; }
        .empty-pg-btn   { background:var(--shark-indigo); color:white; padding:12px 26px; border-radius:12px; font-weight:800; font-size:.82rem; text-decoration:none; display:inline-block; }

        /* Loading */
        .pg-loading { text-align:center; padding:6rem 0; }
        .pg-spinner { width:44px; height:44px; border:4px solid #e2e8f0; border-top-color:var(--shark-indigo); border-radius:50%; animation:spin 1s linear infinite; margin:0 auto 1.2rem; }

        @media (max-width:1000px) {
            .portfolio-layout { grid-template-columns:1fr; }
            .trinity-nav { grid-template-columns:1fr auto; }
            .nav-center { display:none; }
            .header-h1 { font-size:2.4rem; }
            .deal-stats { grid-template-columns:1fr 1fr; }
        }
    </style>
</head>
<body>

    <!-- NAV -->
    <nav class="trinity-nav">
        <div class="nav-left">
            <a href="dashboard.html" class="btn-return">‚Üê Dashboard</a>
        </div>
        <div class="nav-center">
            <span id="navQuote" class="central-statement">Loading your command centre...</span>
        </div>
        <div class="nav-right">
            <div id="liveClock" style="font-family:'JetBrains Mono';color:#4ade80;font-weight:800;font-size:.9rem;">00:00:00</div>
            <div class="cosmic-node" onclick="cycleQuote()">
                <div class="orbit-ring"></div>
                <div class="star-core"></div>
            </div>
        </div>
    </nav>

    <!-- HEADER -->
    <header class="page-header">
        <div class="header-inner-pg">
            <div class="header-text">
                <span class="header-eyebrow">Founder Command Centre</span>
                <h1 class="header-h1" id="pageTitle">My Ventures</h1>
                <p class="header-sub">A forensic record of your proposals, secured funding, and active investor partnerships.</p>
                <div class="header-pills">
                    <div class="h-pill green">
                        <span class="h-pill-val" id="pillFunding">‚Çπ0</span>
                        <span class="h-pill-lbl">Funding Secured</span>
                    </div>
                    <div class="h-pill">
                        <span class="h-pill-val" id="pillDeals">0</span>
                        <span class="h-pill-lbl">Closed Deals</span>
                    </div>
                    <div class="h-pill indigo">
                        <span class="h-pill-val" id="pillProposals">0</span>
                        <span class="h-pill-lbl">Proposals</span>
                    </div>
                    <div class="h-pill">
                        <span class="h-pill-val" id="pillPending">0</span>
                        <span class="h-pill-lbl">Pending Offers</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN -->
    <main class="portfolio-layout" id="mainLayout">
        <div id="pgLoading" class="pg-loading" style="grid-column:1/-1;">
            <div class="pg-spinner"></div>
            <p style="color:#94a3b8;font-weight:700;font-size:.85rem;">Loading your command centre...</p>
        </div>
    </main>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script>
        // ‚îÄ‚îÄ QUOTES ‚îÄ‚îÄ
        const quotes = [
            "The entrepreneur always searches for change, responds to it, and exploits it.",
            "Chase the vision, not the money. The money will follow.",
            "Done is better than perfect.",
            "Risk more than others think is safe.",
            "Build something 100 people love, not something 1 million people kind of like.",
            "Every no gets you closer to a yes.",
        ];
        let qIdx = Math.floor(Math.random() * quotes.length);
        function cycleQuote() {
            const el = document.getElementById('navQuote');
            el.style.opacity='0';
            setTimeout(() => { qIdx=(qIdx+1)%quotes.length; el.textContent=quotes[qIdx]; el.style.opacity='0.5'; }, 300);
        }
        document.getElementById('navQuote').textContent = quotes[qIdx];
        document.getElementById('navQuote').style.transition = 'opacity .3s';
        setInterval(() => {
            document.getElementById('liveClock').textContent =
                new Date().toLocaleTimeString('en-US',{hour12:false});
        }, 1000);

        // ‚îÄ‚îÄ MAIN INIT ‚îÄ‚îÄ
        async function init() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return window.location.href = 'auth.html';

            // Check role
            const { data: profile } = await supabase.from('users').select('*').eq('id', user.id).maybeSingle();
            if (!profile) return window.location.href = 'auth.html';
            if (profile.role === 'investor') return window.location.href = 'investor-portfolio.html';

            document.getElementById('pageTitle').textContent = `${profile.full_name.split(' ')[0]}'s Ventures`;

            // Fetch all proposals
            const { data: proposals } = await supabase
                .from('proposals')
                .select('*')
                .eq('user_id', user.id)
                .order('created_at', { ascending: false });

            // Fetch all deals for this entrepreneur
            const { data: deals } = await supabase
                .from('deals')
                .select('*, proposals(title, category), investor_profile:investor_id(full_name, email)')
                .eq('entrepreneur_id', user.id)
                .order('deal_date', { ascending: false });

            // Fetch pending offers count
            const propIds = (proposals||[]).map(p=>p.id);
            let pendingCount = 0;
            if (propIds.length > 0) {
                const { count } = await supabase.from('offers').select('id',{count:'exact',head:true})
                    .in('proposal_id', propIds).eq('status','pending');
                pendingCount = count || 0;
            }

            // Compute summary stats
            const totalFunding = (deals||[]).reduce((s,d)=>s+parseFloat(d.investment_amount||0),0);
            const avgEquity    = (deals||[]).length > 0
                ? (deals.reduce((s,d)=>s+parseFloat(d.equity_percentage||0),0) / deals.length).toFixed(1)
                : 0;

            // Pill values
            const safe = (id,v) => { const el=document.getElementById(id); if(el) el.textContent=v; };
            safe('pillFunding',   totalFunding >= 10000000
                ? '‚Çπ'+(totalFunding/10000000).toFixed(1)+'Cr'
                : totalFunding >= 100000
                    ? '‚Çπ'+(totalFunding/100000).toFixed(1)+'L'
                    : '‚Çπ'+totalFunding.toLocaleString('en-IN'));
            safe('pillDeals',     (deals||[]).length);
            safe('pillProposals', (proposals||[]).length);
            safe('pillPending',   pendingCount);

            // Remove loading state
            document.getElementById('pgLoading').remove();

            if ((!deals || deals.length === 0) && (!proposals || proposals.length === 0)) {
                document.getElementById('mainLayout').innerHTML = `
                    <div class="empty-pg">
                        <div class="empty-pg-icon">üöÄ</div>
                        <div class="empty-pg-title">No ventures yet</div>
                        <div class="empty-pg-desc">Submit your first proposal to start building your founder portfolio.</div>
                        <a href="submit-proposal.html" class="empty-pg-btn">Submit Proposal</a>
                    </div>`;
                return;
            }

            // Build sector breakdown for sidebar
            const sectors = {};
            (proposals||[]).forEach(p => {
                if (p.category) sectors[p.category] = (sectors[p.category]||0)+1;
            });

            // ‚îÄ‚îÄ LEFT COLUMN ‚îÄ‚îÄ
            const leftCol = document.createElement('div');

            // Section: Funded Deals
            if (deals && deals.length > 0) {
                const dealsLabel = document.createElement('div');
                dealsLabel.className = 'section-lbl';
                dealsLabel.textContent = `ü§ù Closed Deals (${deals.length})`;
                leftCol.appendChild(dealsLabel);

                deals.forEach(deal => {
                    const capital   = parseFloat(deal.investment_amount || 0);
                    const equity    = parseFloat(deal.equity_percentage || 0);
                    const valuation = equity > 0 ? Math.round(capital / (equity / 100)) : 0;
                    const investor  = deal.investor_profile?.full_name || 'Unknown Investor';
                    const propTitle = deal.proposals?.title || 'Unknown Proposal';
                    const category  = deal.proposals?.category || '';
                    const dealDate  = deal.deal_date
                        ? new Date(deal.deal_date).toLocaleDateString('en-IN',{day:'numeric',month:'short',year:'numeric'})
                        : '‚Äî';

                    const node = document.createElement('a');
                    node.className = 'deal-node';
                    node.href = `proposal-details.html?id=${deal.proposal_id}`;
                    node.innerHTML = `
                        <div class="deal-top">
                            <code class="deal-code">DEAL_${deal.id.substring(0,8).toUpperCase()}</code>
                            <span class="deal-date">Closed ${dealDate}</span>
                        </div>
                        <div class="deal-title">${propTitle}</div>
                        <div class="deal-category">üè∑ ${category}</div>
                        <div class="deal-stats">
                            <div class="ds-node emerald">
                                <span class="ds-lbl">Capital Raised</span>
                                <div class="ds-val">‚Çπ${capital >= 100000
                                    ? (capital/100000).toFixed(1)+'L'
                                    : capital.toLocaleString('en-IN')}</div>
                            </div>
                            <div class="ds-node gold">
                                <span class="ds-lbl">Equity Given</span>
                                <div class="ds-val">${equity}%</div>
                            </div>
                            <div class="ds-node indigo">
                                <span class="ds-lbl">Implied Valuation</span>
                                <div class="ds-val">‚Çπ${valuation >= 10000000
                                    ? (valuation/10000000).toFixed(1)+'Cr'
                                    : valuation >= 100000
                                        ? (valuation/100000).toFixed(1)+'L'
                                        : valuation.toLocaleString('en-IN')}</div>
                            </div>
                        </div>
                        <div class="investor-strip">
                            <div class="inv-info">
                                <div class="inv-avatar">${investor.charAt(0).toUpperCase()}</div>
                                <div>
                                    <div class="inv-name">${investor}</div>
                                    <div class="inv-role">Your Investor Partner</div>
                                </div>
                            </div>
                            <span class="inv-link" onclick="event.stopPropagation();window.location.href='proposal-details.html?id=${deal.proposal_id}'">View Proposal ‚Üí</span>
                        </div>`;
                    leftCol.appendChild(node);
                });
            }

            // Section: All Proposals
            if (proposals && proposals.length > 0) {
                const propsLabel = document.createElement('div');
                propsLabel.className = 'section-lbl';
                propsLabel.style.marginTop = deals && deals.length > 0 ? '2rem' : '0';
                propsLabel.textContent = `üìÅ All Proposals (${proposals.length})`;
                leftCol.appendChild(propsLabel);

                // For each proposal, also count offers
                const offerCounts = {};
                if (propIds.length > 0) {
                    const { data: offerData } = await supabase
                        .from('offers').select('proposal_id, status')
                        .in('proposal_id', propIds);
                    (offerData||[]).forEach(o => {
                        if (!offerCounts[o.proposal_id]) offerCounts[o.proposal_id] = { total:0, pending:0 };
                        offerCounts[o.proposal_id].total++;
                        if (o.status === 'pending') offerCounts[o.proposal_id].pending++;
                    });
                }

                proposals.forEach(p => {
                    const cnt     = offerCounts[p.id] || { total:0, pending:0 };
                    const status  = p.verified ? 'live' : (p.status === 'closed' ? 'closed' : 'pending');
                    const labelMap = { live:'‚úì Live', pending:'‚è≥ In Review', closed:'Closed' };

                    const row = document.createElement('a');
                    row.className = 'proposal-row';
                    row.href = `proposal-details.html?id=${p.id}`;
                    row.innerHTML = `
                        <div>
                            <div class="pr-title">${p.title}</div>
                            <div class="pr-meta">
                                ${p.category || 'General'} ¬∑ Asking ‚Çπ${parseFloat(p.amount_needed||0) >= 100000
                                    ? (parseFloat(p.amount_needed)/100000).toFixed(1)+'L'
                                    : parseFloat(p.amount_needed||0).toLocaleString('en-IN')}
                                ¬∑ ${p.equity_offered}% equity
                            </div>
                        </div>
                        <div class="pr-badges">
                            ${cnt.pending > 0 ? `<span class="pr-offers">üî• ${cnt.pending} pending</span>` : ''}
                            ${cnt.total > 0 && cnt.pending === 0 ? `<span style="font-size:.72rem;font-weight:700;color:#64748b;">${cnt.total} offer${cnt.total!==1?'s':''}</span>` : ''}
                            <span class="pr-badge ${status}">${labelMap[status]}</span>
                        </div>`;
                    leftCol.appendChild(row);
                });
            }

            // ‚îÄ‚îÄ RIGHT SIDEBAR ‚îÄ‚îÄ
            const rightCol = document.createElement('aside');
            rightCol.className = 'sidebar-card sticky-sidebar';

            // Portfolio intel
            rightCol.innerHTML = `
                <div class="sidebar-title">üìä Founder Intelligence</div>
                <div class="stat-row">
                    <span class="stat-row-label">Total Raised</span>
                    <span class="stat-row-val" style="color:var(--shark-emerald);">‚Çπ${
                        totalFunding >= 10000000
                            ? (totalFunding/10000000).toFixed(1)+'Cr'
                            : totalFunding >= 100000
                                ? (totalFunding/100000).toFixed(1)+'L'
                                : totalFunding.toLocaleString('en-IN')
                    }</span>
                </div>
                <div class="stat-row">
                    <span class="stat-row-label">Active Deals</span>
                    <span class="stat-row-val">${(deals||[]).length}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-row-label">Avg Equity Sold</span>
                    <span class="stat-row-val" style="color:#f59e0b;">${avgEquity}%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-row-label">Pending Offers</span>
                    <span class="stat-row-val" style="color:var(--shark-indigo);">${pendingCount}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-row-label">Total Proposals</span>
                    <span class="stat-row-val">${(proposals||[]).length}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-row-label">Success Rate</span>
                    <span class="stat-row-val">${
                        proposals && proposals.length > 0
                            ? Math.round(((deals||[]).length / proposals.length)*100)+'%'
                            : '‚Äî'
                    }</span>
                </div>

                ${Object.keys(sectors).length > 0 ? `
                <div style="margin-top:1.5rem;">
                    <div class="sidebar-title">üè∑ Sector Breakdown</div>
                    ${Object.entries(sectors).map(([s,c]) => {
                        const pct = Math.round((c/(proposals||[]).length)*100);
                        return `<div class="sector-row"><span>${s}</span><span>${pct}%</span></div>
                                <div class="sector-bar"><div class="sector-fill" style="width:${pct}%"></div></div>`;
                    }).join('')}
                </div>` : ''}

                <div style="margin-top:1.5rem;">
                    <div class="tip-box">
                        <span class="tip-eyebrow">‚ú¶ Founder's Note</span>
                        <div class="tip-text" id="sidebarTip">Loading tip...</div>
                        <span class="tip-author" id="sidebarTipAuthor">‚Äî</span>
                    </div>
                </div>

                <div style="margin-top:1.2rem;display:flex;flex-direction:column;gap:8px;">
                    <a href="submit-proposal.html" style="display:block;text-align:center;background:var(--shark-indigo);color:white;padding:12px;border-radius:12px;font-weight:800;font-size:.8rem;text-decoration:none;">üöÄ New Proposal</a>
                    <a href="dashboard.html" style="display:block;text-align:center;background:#f8fafc;color:var(--shark-obsidian);padding:12px;border-radius:12px;font-weight:800;font-size:.8rem;text-decoration:none;border:1.5px solid var(--shark-border);">‚Üê Dashboard</a>
                </div>`;

            document.getElementById('mainLayout').appendChild(leftCol);
            document.getElementById('mainLayout').appendChild(rightCol);

            // Set sidebar tip
            const tips = [
                { t:"The secret to getting ahead is getting started.", a:"Mark Twain" },
                { t:"Done is better than perfect.", a:"Sheryl Sandberg" },
                { t:"Chase the vision, not the money.", a:"Tony Hsieh" },
                { t:"A ship in harbor is safe, but that's not what ships are built for.", a:"John Shedd" },
                { t:"Opportunities don't happen. You create them.", a:"Chris Grosser" },
            ];
            const tip = tips[Math.floor(Math.random()*tips.length)];
            document.getElementById('sidebarTip').textContent = `"${tip.t}"`;
            document.getElementById('sidebarTipAuthor').textContent = `‚Äî ${tip.a}`;
        }

        window.onload = init;
    </script>
</body>
</html>
