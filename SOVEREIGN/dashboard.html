<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Terminal | Sovereign Hub</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <link rel="stylesheet" href="css/dashboard.css">
    <style>
        /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
        .main-nav {
            background: rgba(2,6,23,0.88) !important;
            backdrop-filter: blur(24px) !important;
            border-bottom: 1px solid rgba(99,102,241,0.18) !important;
        }
        .nav-brand { color: white !important; font-size: 1.35rem !important; letter-spacing: -0.05em !important; }
        .nav-brand span { color: var(--shark-indigo) !important; }
        .nav-links a { color: rgba(255,255,255,0.5) !important; font-size: 0.82rem !important; font-weight: 700 !important; border-radius: 10px !important; padding: 0.55rem 1rem !important; transition:.2s !important; }
        .nav-links a:hover { color: white !important; background: rgba(255,255,255,0.07) !important; }
        .nav-links a.active { color: white !important; background: rgba(99,102,241,0.22) !important; }
        .user-pill { border: 1px solid rgba(255,255,255,0.15) !important; background: rgba(255,255,255,0.08) !important; }
        .user-pill:hover { border-color: rgba(255,255,255,0.3) !important; background: rgba(255,255,255,0.12) !important; }
        #userName { color: rgba(255,255,255,0.9) !important; font-size: 0.82rem !important; }
        .nav-avatar { background: linear-gradient(135deg,#6366f1,#8b5cf6) !important; }
        .icon-btn { background: rgba(255,255,255,0.07) !important; border: 1px solid rgba(255,255,255,0.12) !important; color: rgba(255,255,255,0.7) !important; }
        .icon-btn:hover { background: rgba(99,102,241,0.25) !important; border-color: rgba(99,102,241,0.5) !important; color: white !important; }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        .dashboard-header {
            background: var(--shark-obsidian) !important;
            background-image:
                radial-gradient(ellipse at 85% -5%, rgba(99,102,241,0.25) 0%, transparent 52%),
                radial-gradient(ellipse at 5% 110%, rgba(16,185,129,0.07) 0%, transparent 48%) !important;
            padding: 3.8rem 0 10rem !important;
            border-radius: 0 0 52px 52px !important;
            box-shadow: 0 32px 60px -12px rgba(0,0,0,0.4) !important;
            position: relative; overflow: hidden;
        }
        .dashboard-header::before {
            content:''; position:absolute; inset:0;
            background-image: linear-gradient(rgba(99,102,241,0.035) 1px, transparent 1px),
                              linear-gradient(90deg,rgba(99,102,241,0.035) 1px, transparent 1px);
            background-size: 52px 52px;
            mask-image: radial-gradient(ellipse at 50% 50%, black 15%, transparent 72%);
            pointer-events:none;
        }
        .welcome-text {
            font-size: 3rem !important; font-weight: 900 !important;
            letter-spacing: -0.055em !important; line-height: 1 !important;
            margin-bottom: 1rem !important;
            background: linear-gradient(135deg,#fff 55%,rgba(165,180,252,0.75));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        #roleBadgeLabel {
            font-size: 0.58rem !important; letter-spacing: 5px !important;
            color: var(--shark-indigo) !important; text-transform: uppercase !important;
            font-weight: 900 !important; display: block; margin-bottom: 8px;
        }
        .header-inner { align-items: center !important; }
        .header-right-panel { display:flex; align-items:center; justify-content:flex-end; }

        /* ‚îÄ‚îÄ COMBINED WATCH ‚îÄ‚îÄ */
        #sovereignWatch {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 24px;
            padding: 20px 24px;
            backdrop-filter: blur(12px);
        }
        /* Analog clock */
        #analogClock {
            position: relative;
            width: 100px; height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #1e2a4a, #020617);
            border: 2px solid rgba(99,102,241,0.4);
            box-shadow: 0 0 0 1px rgba(99,102,241,0.1), inset 0 0 20px rgba(99,102,241,0.05);
        }
        #analogClock::after {
            content:''; position:absolute; top:50%; left:50%;
            width:6px; height:6px; border-radius:50%;
            background: var(--shark-indigo);
            transform: translate(-50%,-50%);
            z-index:10;
            box-shadow: 0 0 8px rgba(99,102,241,0.8);
        }
        .clock-hand {
            position: absolute; bottom: 50%; left: 50%;
            transform-origin: bottom center;
            border-radius: 4px 4px 0 0;
        }
        .hand-hour   { width:3px; height:28px; background:#fff; margin-left:-1.5px; box-shadow:0 0 6px rgba(255,255,255,0.3); }
        .hand-min    { width:2px; height:36px; background:#a5b4fc; margin-left:-1px; box-shadow:0 0 6px rgba(165,180,252,0.5); }
        .hand-sec    { width:1px; height:40px; background:#10b981; margin-left:-.5px; box-shadow:0 0 8px rgba(16,185,129,0.8); }

        /* Clock tick marks */
        .tick {
            position:absolute; top:50%; left:50%;
            transform-origin: center bottom;
            width:1px; height:5px;
            background: rgba(255,255,255,0.15);
        }
        .tick.major { width:2px; height:7px; background:rgba(255,255,255,0.35); }

        /* Digital clock */
        #digitalClock {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.05rem;
            font-weight: 700;
            color: white;
            letter-spacing: 2px;
            text-shadow: 0 0 12px rgba(99,102,241,0.6);
        }
        #digitalDate {
            font-size: 0.56rem;
            font-weight: 800;
            color: rgba(255,255,255,0.35);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-align: center;
        }

        /* ‚îÄ‚îÄ BTN-HEADER ‚îÄ‚îÄ */
        .btn-header {
            background: rgba(255,255,255,0.06) !important; border: 1px solid rgba(255,255,255,0.1) !important;
            color: rgba(255,255,255,0.82) !important; padding: 9px 16px !important;
            border-radius: 11px !important; font-size: 0.75rem !important; font-weight: 700 !important;
            transition:.22s !important; text-decoration:none !important;
            display:inline-flex !important; align-items:center !important; gap:6px !important;
        }
        .btn-header:hover { background:rgba(99,102,241,0.2) !important; border-color:rgba(99,102,241,0.4) !important; color:white !important; transform:translateY(-2px) !important; }

        /* ‚îÄ‚îÄ STAT CARDS ‚Äî FIXED ‚îÄ‚îÄ */
        .stats-grid {
            grid-template-columns: repeat(4, 1fr) !important;
            gap: 1.2rem !important;
            margin-top: -5.5rem !important;
            padding: 0 2.5rem !important;
        }
        .stat-card {
            border-radius: 24px !important;
            padding: 1.6rem 1.8rem !important;
            border: 1px solid rgba(226,232,240,0.9) !important;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05), 0 1px 2px rgba(0,0,0,0.04) !important;
            transition: .32s cubic-bezier(0.23,1,0.32,1) !important;
            position: relative; overflow: hidden;
            min-height: unset !important;
        }
        .stat-card::before {
            content:''; position:absolute; top:0; left:0; right:0;
            height:3px; background:linear-gradient(90deg,var(--shark-indigo),#818cf8);
            opacity:0; transition:.3s;
        }
        .stat-card:hover { transform:translateY(-8px) !important; box-shadow:0 20px 40px rgba(99,102,241,0.1), 0 4px 6px rgba(0,0,0,0.04) !important; border-color:rgba(99,102,241,0.2) !important; }
        .stat-card:hover::before { opacity:1; }
        .stat-card::after { display:none !important; }

        .stat-label {
            font-size: 0.6rem !important; letter-spacing: 2px !important; font-weight: 800 !important;
            color: #94a3b8 !important; margin-bottom: 10px !important;
            display: flex !important; align-items: center !important; gap: 6px !important;
        }
        .stat-label-icon { width:20px; height:20px; border-radius:7px; display:inline-flex; align-items:center; justify-content:center; font-size:0.68rem; flex-shrink:0; }

        /* ‚îÄ‚îÄ STAT VALUE ‚Äî RESPONSIVE FONT ‚îÄ‚îÄ */
        .stat-value {
            font-size: clamp(1.4rem, 2.5vw, 2.2rem) !important;
            font-weight: 900 !important;
            letter-spacing: -1.5px !important;
            color: var(--shark-obsidian) !important;
            line-height: 1 !important;
            word-break: break-all !important;
            overflow-wrap: anywhere !important;
        }
        .stat-delta {
            font-size: 0.68rem; font-weight: 600; color: #94a3b8;
            margin-top: 8px; display: block; line-height: 1.3;
        }

        /* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
        .tabs { background:white !important; border:1px solid var(--shark-border) !important; padding:5px !important; border-radius:18px !important; box-shadow:0 2px 8px rgba(0,0,0,0.04) !important; margin-bottom:2.5rem !important; width:fit-content; }
        .tab { padding:0.7rem 1.4rem !important; border-radius:14px !important; font-size:0.82rem !important; font-weight:700 !important; color:#64748b !important; transition:.2s !important; }
        .tab:hover { color:var(--shark-obsidian) !important; background:#f8fafc !important; }
        .tab.active { background:var(--shark-obsidian) !important; color:white !important; box-shadow:0 4px 14px rgba(2,6,23,0.2) !important; }

        /* ‚îÄ‚îÄ QUICK ACTION STRIP ‚îÄ‚îÄ */
        .qa-strip { display:flex; gap:10px; margin-bottom:1.8rem; flex-wrap:wrap; }
        .qa-btn {
            display:flex; align-items:center; gap:8px; padding:10px 18px;
            border-radius:12px; border:1.5px solid var(--shark-border); background:white;
            font-size:0.78rem; font-weight:800; color:var(--shark-obsidian); text-decoration:none;
            cursor:pointer; transition:.2s; box-shadow:0 2px 8px rgba(0,0,0,0.03);
            white-space: nowrap;
        }
        .qa-btn:hover { border-color:var(--shark-indigo); color:var(--shark-indigo); transform:translateY(-2px); box-shadow:0 8px 20px rgba(99,102,241,0.1); }
        .qa-btn.primary { background:var(--shark-indigo); border-color:var(--shark-indigo); color:white; box-shadow:0 8px 20px rgba(99,102,241,0.25); }
        .qa-btn.primary:hover { background:#4f46e5; border-color:#4f46e5; transform:translateY(-2px); }

        /* ‚îÄ‚îÄ ACTIVITY FEED ‚îÄ‚îÄ */
        .activity-feed-wrap { background:white; border-radius:24px; border:1px solid var(--shark-border); padding:1.6rem 2rem; margin-bottom:1.8rem; box-shadow:0 4px 20px rgba(0,0,0,0.03); }
        .feed-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.2rem; }
        .feed-title { font-size:0.62rem; font-weight:900; color:var(--shark-indigo); text-transform:uppercase; letter-spacing:3px; }
        .feed-dot { width:7px; height:7px; background:var(--shark-emerald); border-radius:50%; animation:livePulse 2s infinite; display:inline-block; margin-right:6px; }
        @keyframes livePulse { 0%,100%{opacity:1;transform:scale(1);} 50%{opacity:.5;transform:scale(1.3);} }
        .feed-item { display:flex; align-items:flex-start; gap:12px; padding:10px 0; border-bottom:1px solid #f8fafc; }
        .feed-item:last-child { border-bottom:none; padding-bottom:0; }
        .feed-icon { width:32px; height:32px; border-radius:9px; display:flex; align-items:center; justify-content:center; font-size:0.82rem; flex-shrink:0; }
        .feed-text { font-size:0.8rem; font-weight:600; color:var(--shark-text); line-height:1.4; }
        .feed-time { font-size:0.63rem; color:#94a3b8; margin-top:2px; font-family:'JetBrains Mono',monospace; }

        /* ‚îÄ‚îÄ SECTION DIVIDER ‚îÄ‚îÄ */
        .section-divider { display:flex; align-items:center; gap:12px; margin-bottom:1.6rem; }
        .section-divider-label { font-size:0.6rem; font-weight:900; text-transform:uppercase; letter-spacing:3px; color:#94a3b8; white-space:nowrap; }
        .section-divider-line { flex:1; height:1px; background:var(--shark-border); }

        /* ‚îÄ‚îÄ CARDS ‚Äî NO MIN-HEIGHT, EVEN BUTTONS ‚îÄ‚îÄ */
        .card, .proposal-card {
            border-radius:24px !important; padding:1.8rem !important;
            box-shadow:0 2px 12px rgba(0,0,0,0.04) !important;
            transition:.28s cubic-bezier(0.23,1,0.32,1) !important;
            min-height: unset !important;
            display: flex !important; flex-direction: column !important;
        }
        .card:hover, .proposal-card:hover { transform:translateY(-5px) !important; border-color:rgba(99,102,241,0.22) !important; box-shadow:0 16px 32px rgba(99,102,241,0.08),0 4px 6px rgba(0,0,0,0.04) !important; }

        /* All action buttons at bottom of cards are uniform */
        .card .btn, .proposal-card .btn { margin-top:auto !important; }
        .card a.btn, .proposal-card a.btn { text-align:center !important; text-decoration:none !important; }

        /* ‚îÄ‚îÄ EMPTY STATES ‚îÄ‚îÄ */
        .empty-state {
            display:none; grid-column:1/-1;
            background:white; border-radius:24px; border:1px solid var(--shark-border);
            padding:3.5rem; text-align:center; box-shadow:0 4px 20px rgba(0,0,0,0.03);
        }
        .empty-state-icon { font-size:2.5rem; margin-bottom:.8rem; }
        .empty-state-title { font-size:1.3rem; font-weight:900; color:var(--shark-obsidian); letter-spacing:-.03em; margin-bottom:.4rem; }
        .empty-state-desc { color:#94a3b8; font-weight:600; font-size:.85rem; margin-bottom:1.6rem; }
        .empty-state-btn { background:var(--shark-indigo); color:white; padding:12px 24px; border-radius:12px; font-weight:800; font-size:.82rem; text-decoration:none; display:inline-block; }

        /* ‚îÄ‚îÄ NOTIF ‚îÄ‚îÄ */
        .notif-item { padding:1rem 1.4rem !important; transition:.15s !important; }
        .notif-item.unread { background:rgba(99,102,241,0.03) !important; border-left:3px solid var(--shark-indigo) !important; }
        .notif-item strong { font-size:.82rem !important; font-weight:800 !important; }
        .notif-item p { font-size:.74rem !important; line-height:1.5 !important; }

        /* ‚îÄ‚îÄ BADGE ‚îÄ‚îÄ */
        .badge { font-size:0.65rem !important; padding:6px 14px !important; border-radius:50px !important; font-weight:800 !important; letter-spacing:.5px !important; }

        /* ‚îÄ‚îÄ SUPPORT ‚îÄ‚îÄ */
        .help-btn { background:var(--shark-indigo) !important; border-color:transparent !important; box-shadow:0 8px 24px rgba(99,102,241,0.35) !important; }
        .support-node:hover .help-btn { background:#4f46e5 !important; transform:scale(1.08) rotate(8deg) !important; }
        .pulse-ring { border-color:var(--shark-indigo) !important; }

        /* ‚îÄ‚îÄ GRID FIX ‚îÄ‚îÄ */
        .grid-container { display:contents !important; }
        .tab-content.active { min-height: 200px; }
    </style>
</head>
<body>

    <!-- NAV -->
    <nav class="main-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">SOVEREIGN<span>HUB</span></a>
            <div class="nav-links" id="navLinks">
                <a href="dashboard.html" class="active">Dashboard</a>
                <a href="proposals.html">Marketplace</a>
                <a href="chat.html">Messages</a>
            </div>
            <div class="nav-actions">
                <div id="notifWrapper" style="position:relative;">
                    <button class="icon-btn" onclick="window.toggleNotifications(event)">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span id="notifBadge" class="badge-dot" style="display:none;"></span>
                    </button>
                    <div id="notifPanel" class="dropdown-content">
                        <div style="padding:1.2rem 1.4rem;border-bottom:1px solid #f1f5f9;display:flex;justify-content:space-between;align-items:center;background:#f8fafc;">
                            <strong style="font-size:.75rem;letter-spacing:1px;text-transform:uppercase;">Activity</strong>
                            <button onclick="window.markAllNotificationsRead()" style="background:none;border:none;color:var(--shark-indigo);font-weight:800;cursor:pointer;font-size:.7rem;text-transform:uppercase;letter-spacing:.5px;">Clear All</button>
                        </div>
                        <div id="notifList" style="max-height:400px;overflow-y:auto;"></div>
                    </div>
                </div>
                <div id="userWrapper" style="position:relative;">
                    <div class="user-pill" onclick="window.toggleUserMenu(event)">
                        <div class="nav-avatar" id="userAvatar">U</div>
                        <span id="userName" style="font-weight:800;font-size:.9rem;">Authorized User</span>
                    </div>
                    <div id="userDropdown" class="dropdown-content" style="width:240px;">
                        <a href="profile.html" style="display:block;padding:14px 20px;color:#475569;text-decoration:none;font-weight:700;font-size:.85rem;border-bottom:1px solid #f8fafc;">‚öôÔ∏è Account Settings</a>
                        <a href="funding-history.html" style="display:block;padding:14px 20px;color:#475569;text-decoration:none;font-weight:700;font-size:.85rem;border-bottom:1px solid #f8fafc;">üßæ Forensic Ledger</a>
                        <a href="#" onclick="handleLogout()" style="display:block;padding:14px 20px;color:#ef4444;text-decoration:none;font-weight:800;font-size:.85rem;">üî¥ Terminate Session</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- HEADER -->
    <div class="dashboard-header">
        <div class="header-inner">
            <div>
                <span id="roleBadgeLabel">Nexus Terminal</span>
                <h1 id="welcomeMessage" class="welcome-text">Initiating Neural Link...</h1>
                <div class="header-meta" style="margin-bottom:1.4rem;">
                    <span id="roleBadge" class="badge" style="background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);color:rgba(255,255,255,0.7);">Role</span>
                    <span id="verificationBadge" class="badge" style="background:rgba(16,185,129,0.15);color:#6ee7b7;border:1px solid rgba(16,185,129,0.25);">‚úì Verified</span>
                </div>
                <div class="header-actions">
                    <a href="proposals.html"           id="findDealsBtn"              class="btn-header">üîç Discovery Hub</a>
                    <a href="investor-portfolio.html"  id="investorPortfolioBtn"      class="btn-header hidden">üèõÔ∏è Portfolio</a>
                    <a href="entrepreneur-portfolio.html" id="entrepreneurPortfolioBtn" class="btn-header hidden">üöÄ My Ventures</a>
                    <a href="support-info.html"                                       class="btn-header">üõ†Ô∏è Support</a>
                    <a href="submit-proposal.html"     id="submitProposalBtn"         class="btn-header hidden">‚úèÔ∏è New Proposal</a>
                    <a href="deals.html"               id="portfolioBtn"              class="btn-header">üìÇ My Deals</a>
                    <a href="funding-history.html"     id="ledgerBtn"                 class="btn-header">üßæ Ledger</a>
                </div>
            </div>

            <!-- SOVEREIGN WATCH -->
            <div class="header-right-panel">
                <div id="sovereignWatch">
                    <div id="analogClock">
                        <!-- Tick marks injected by JS -->
                        <div class="clock-hand hand-hour"  id="handHour"></div>
                        <div class="clock-hand hand-min"   id="handMin"></div>
                        <div class="clock-hand hand-sec"   id="handSec"></div>
                    </div>
                    <div id="digitalClock">00:00:00</div>
                    <div id="digitalDate">‚Äî</div>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN -->
    <main class="dashboard-content">
        <div id="loadingState" class="loading">
            <div class="spinner"></div>
            <p style="font-weight:700;margin-top:1.5rem;color:#94a3b8;font-size:.85rem;">Verifying Secure Data Nodes...</p>
        </div>

        <!-- ENTREPRENEUR VIEW -->
        <div id="entrepreneurDashboard" style="display:none;">
            <div class="stats-grid">
                <div class="stat-card" onclick="switchEntrepreneurTab('my-proposals',{currentTarget:document.querySelectorAll('#entrepreneurDashboard .tab')[1]})" style="cursor:pointer;" title="View your proposals">
                    <div class="stat-label"><span class="stat-label-icon" style="background:#eff6ff;">üìÅ</span>Total Proposals</div>
                    <div class="stat-value" id="statTotalProposals">0</div>
                    <span class="stat-delta">Tap to view proposals ‚Üí</span>
                </div>
                <div class="stat-card" onclick="switchEntrepreneurTab('deals',{currentTarget:document.querySelectorAll('#entrepreneurDashboard .tab')[3]})" style="cursor:pointer;" title="View your closed deals">
                    <div class="stat-label"><span class="stat-label-icon" style="background:#f0fdf4;">üí∞</span>Funding Secured</div>
                    <div class="stat-value" id="statFundingReceived" style="color:var(--shark-emerald);">‚Çπ0</div>
                    <span class="stat-delta">Tap to view deals ‚Üí</span>
                </div>
                <div class="stat-card" onclick="switchEntrepreneurTab('offers',{currentTarget:document.querySelectorAll('#entrepreneurDashboard .tab')[2]})" style="cursor:pointer;" title="View pending offers">
                    <div class="stat-label"><span class="stat-label-icon" style="background:#fefce8;">üì®</span>Pending Offers</div>
                    <div class="stat-value" id="statActiveOffers" style="color:#f59e0b;">0</div>
                    <span class="stat-delta">Tap to review offers ‚Üí</span>
                </div>
                <div class="stat-card" onclick="switchEntrepreneurTab('overview',{currentTarget:document.querySelectorAll('#entrepreneurDashboard .tab')[0]})" style="cursor:pointer;" title="View deal success rate">
                    <div class="stat-label"><span class="stat-label-icon" style="background:#f5f3ff;">üìà</span>Deal Success Rate</div>
                    <div class="stat-value" id="statSuccessRate" style="color:var(--shark-indigo);">0%</div>
                    <span class="stat-delta">Deals closed vs proposals</span>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="qa-strip" id="quickActions">
                <a href="submit-proposal.html" class="qa-btn primary" id="qaSubmitBtn" style="display:none;">üöÄ New Proposal</a>
                <a href="proposals.html"       class="qa-btn">üîç Browse Marketplace</a>
                <a href="chat.html"            class="qa-btn">üí¨ Messages</a>
                <a href="funding-history.html" class="qa-btn">üßæ Ledger</a>
            </div>

            <!-- Mood Refresher -->
            <div id="moodRefresher" style="background:linear-gradient(135deg,#020617 0%,#1e1b4b 100%);border-radius:20px;padding:1.5rem 2rem;margin-bottom:1.8rem;border:1px solid rgba(99,102,241,0.2);position:relative;overflow:hidden;">
                <div style="position:absolute;inset:0;background-image:radial-gradient(circle at 80% 50%,rgba(99,102,241,0.12) 0%,transparent 60%);pointer-events:none;"></div>
                <div style="display:flex;justify-content:space-between;align-items:center;gap:1rem;position:relative;">
                    <div style="flex:1;">
                        <div style="font-size:.55rem;font-weight:900;color:var(--shark-indigo);text-transform:uppercase;letter-spacing:3px;margin-bottom:.5rem;">‚ú¶ Founder's Fuel</div>
                        <div id="moodQuote" style="font-size:1rem;font-weight:700;color:white;line-height:1.5;letter-spacing:-.01em;">"Loading inspiration..."</div>
                        <div id="moodAuthor" style="font-size:.7rem;color:rgba(255,255,255,0.4);margin-top:.4rem;font-weight:600;">‚Äî</div>
                    </div>
                    <button onclick="refreshMood()" style="background:rgba(99,102,241,0.15);border:1px solid rgba(99,102,241,0.3);color:#a5b4fc;padding:8px 14px;border-radius:10px;font-size:.72rem;font-weight:800;cursor:pointer;transition:.2s;white-space:nowrap;" onmouseover="this.style.background='rgba(99,102,241,0.25)'" onmouseout="this.style.background='rgba(99,102,241,0.15)'">‚Üª New</button>
                </div>
            </div>

            <!-- Tabs -->
            <div class="section-divider">
                <span class="section-divider-label">Command View</span>
                <div class="section-divider-line"></div>
            </div>
            <div class="tabs">
                <button class="tab active" onclick="switchEntrepreneurTab('overview',event)">üè† Pending Offers</button>
                <button class="tab"        onclick="switchEntrepreneurTab('my-proposals',event)">üìÅ My Proposals</button>
                <button class="tab"        onclick="switchEntrepreneurTab('offers',event)">üì® All Offers</button>
                <button class="tab"        onclick="switchEntrepreneurTab('deals',event)">ü§ù Closed Deals</button>
            </div>

            <div class="tab-content active" id="overview-tab">
                <div id="recentProposalsGrid" class="grid-container"></div>
                <div class="empty-state" id="overviewEmpty">
                    <div class="empty-state-icon">üì®</div>
                    <div class="empty-state-title">No pending offers</div>
                    <div class="empty-state-desc">You're all caught up! No investors are waiting on your response right now.</div>
                    <a href="proposals.html" class="empty-state-btn">Browse Marketplace</a>
                </div>
            </div>
            <div class="tab-content" id="my-proposals-tab">
                <div id="allProposalsGrid" class="grid-container"></div>
                <div class="empty-state" id="myProposalsEmpty">
                    <div class="empty-state-icon">üìÅ</div>
                    <div class="empty-state-title">No proposals yet</div>
                    <div class="empty-state-desc">Create your first pitch and get in front of investors.</div>
                    <a href="submit-proposal.html" class="empty-state-btn">+ New Proposal</a>
                </div>
            </div>
            <div class="tab-content" id="offers-tab">
                <div id="offersContainer" class="grid-container"></div>
                <div class="empty-state" id="offersEmpty">
                    <div class="empty-state-icon">üì®</div>
                    <div class="empty-state-title">No offers yet</div>
                    <div class="empty-state-desc">Once investors submit offers on your proposals they'll appear here.</div>
                    <a href="proposals.html" class="empty-state-btn">üîç See Marketplace</a>
                </div>
            </div>
            <div class="tab-content" id="deals-tab">
                <div id="dealsContainer" class="grid-container"></div>
                <div class="empty-state" id="dealsEmpty">
                    <div class="empty-state-icon">ü§ù</div>
                    <div class="empty-state-title">No deals closed yet</div>
                    <div class="empty-state-desc">Accept an investor offer to close your first deal.</div>
                    <a href="dashboard.html" class="empty-state-btn">View Offers</a>
                </div>
            </div>
        </div>

        <!-- INVESTOR VIEW -->
        <div id="investorDashboard" style="display:none;">
            <div class="stats-grid">
                <div class="stat-card" onclick="switchInvestorTab('my-deals',{currentTarget:document.querySelectorAll('#investorDashboard .tab')[2]})" style="cursor:pointer;" title="View portfolio">
                    <div class="stat-label"><span class="stat-label-icon" style="background:#f5f3ff;">üèõÔ∏è</span>Portfolio Size</div>
                    <div class="stat-value" id="statTotalInvestments">0</div>
                    <span class="stat-delta">Tap to view portfolio ‚Üí</span>
                </div>
                <div class="stat-card" onclick="switchInvestorTab('my-deals',{currentTarget:document.querySelectorAll('#investorDashboard .tab')[2]})" style="cursor:pointer;" title="View capital deployed">
                    <div class="stat-label"><span class="stat-label-icon" style="background:#f0fdf4;">üí∏</span>Capital Deployed</div>
                    <div class="stat-value" id="statAmountInvested" style="color:var(--shark-emerald);">‚Çπ0</div>
                    <span class="stat-delta">Tap to view deals ‚Üí</span>
                </div>
                <div class="stat-card" onclick="switchInvestorTab('my-offers',{currentTarget:document.querySelectorAll('#investorDashboard .tab')[1]})" style="cursor:pointer;" title="View my offers">
                    <div class="stat-label"><span class="stat-label-icon" style="background:#fefce8;">üìä</span>Avg Equity Held</div>
                    <div class="stat-value" id="statAverageROI" style="color:#f59e0b;">0.0%</div>
                    <span class="stat-delta">Tap to view offers ‚Üí</span>
                </div>
                <div class="stat-card" onclick="switchInvestorTab('available',{currentTarget:document.querySelectorAll('#investorDashboard .tab')[0]})" style="cursor:pointer;" title="Browse marketplace">
                    <div class="stat-label"><span class="stat-label-icon" style="background:#ecfdf5;">ü§ù</span>Closed Deals</div>
                    <div class="stat-value" id="statSuccessfulDeals" style="color:var(--shark-indigo);">0</div>
                    <span class="stat-delta">Tap to browse deals ‚Üí</span>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="qa-strip">
                <a href="proposals.html"          class="qa-btn primary">üîç Find Deals</a>
                <a href="investor-portfolio.html"  class="qa-btn">üèõÔ∏è My Portfolio</a>
                <a href="chat.html"               class="qa-btn">üí¨ Messages</a>
                <a href="funding-history.html"    class="qa-btn">üßæ Ledger</a>
            </div>

            <!-- Mood Refresher -->
            <div style="background:linear-gradient(135deg,#020617 0%,#1e1b4b 100%);border-radius:20px;padding:1.5rem 2rem;margin-bottom:1.8rem;border:1px solid rgba(99,102,241,0.2);position:relative;overflow:hidden;">
                <div style="position:absolute;inset:0;background-image:radial-gradient(circle at 80% 50%,rgba(99,102,241,0.12) 0%,transparent 60%);pointer-events:none;"></div>
                <div style="display:flex;justify-content:space-between;align-items:center;gap:1rem;position:relative;">
                    <div style="flex:1;">
                        <div style="font-size:.55rem;font-weight:900;color:var(--shark-indigo);text-transform:uppercase;letter-spacing:3px;margin-bottom:.5rem;">‚ú¶ Investor's Edge</div>
                        <div id="moodQuoteInvestor" style="font-size:1rem;font-weight:700;color:white;line-height:1.5;letter-spacing:-.01em;">"Loading inspiration..."</div>
                        <div id="moodAuthorInvestor" style="font-size:.7rem;color:rgba(255,255,255,0.4);margin-top:.4rem;font-weight:600;">‚Äî</div>
                    </div>
                    <button onclick="refreshMoodInvestor()" style="background:rgba(99,102,241,0.15);border:1px solid rgba(99,102,241,0.3);color:#a5b4fc;padding:8px 14px;border-radius:10px;font-size:.72rem;font-weight:800;cursor:pointer;transition:.2s;white-space:nowrap;" onmouseover="this.style.background='rgba(99,102,241,0.25)'" onmouseout="this.style.background='rgba(99,102,241,0.15)'">‚Üª New</button>
                </div>
            </div>

            <!-- Tabs -->
            <div class="section-divider">
                <span class="section-divider-label">Command View</span>
                <div class="section-divider-line"></div>
            </div>
            <div class="tabs">
                <button class="tab active" onclick="switchInvestorTab('available',event)">üîç Browse Deals</button>
                <button class="tab"        onclick="switchInvestorTab('my-offers',event)">üì§ My Offers</button>
                <button class="tab"        onclick="switchInvestorTab('my-deals',event)">üèõÔ∏è My Portfolio</button>
            </div>

            <div class="tab-content active" id="available-tab">
                <div id="availableProposalsGrid" class="grid-container"></div>
                <div class="empty-state" id="availableEmpty">
                    <div class="empty-state-icon">üîç</div>
                    <div class="empty-state-title">No proposals available</div>
                    <div class="empty-state-desc">Check back soon ‚Äî new pitches are reviewed daily.</div>
                </div>
            </div>
            <div class="tab-content" id="my-offers-tab">
                <div id="myOffersContainer" class="grid-container"></div>
                <div class="empty-state" id="myOffersEmpty">
                    <div class="empty-state-icon">üí∞</div>
                    <div class="empty-state-title">No offers submitted yet</div>
                    <div class="empty-state-desc">Browse the marketplace and submit your first term sheet.</div>
                    <a href="proposals.html" class="empty-state-btn">üîç Browse Marketplace</a>
                </div>
            </div>
            <div class="tab-content" id="my-deals-tab">
                <div id="myDealsContainer" class="grid-container"></div>
                <div class="empty-state" id="myDealsEmpty">
                    <div class="empty-state-icon">üèõÔ∏è</div>
                    <div class="empty-state-title">Portfolio is empty</div>
                    <div class="empty-state-desc">Close your first deal to start building your portfolio.</div>
                    <a href="proposals.html" class="empty-state-btn">Find Opportunities</a>
                </div>
            </div>
        </div>
    </main>

    <!-- SUPPORT BTN -->
    <div class="support-node" onclick="toggleSupportModal()">
        <div class="help-label">System Support</div>
        <div class="help-anchor">
            <div class="pulse-ring"></div>
            <div class="help-btn">?</div>
        </div>
    </div>

    <!-- SUPPORT MODAL -->
    <div id="supportModal" class="modal-overlay" onclick="toggleSupportModal()">
        <div class="profile-modal" onclick="event.stopPropagation()">
            <div class="support-header">
                <h2>Terminal Support</h2>
                <p>Submit a forensic inquiry to the oversight team.</p>
            </div>
            <form id="supportForm">
                <div class="sup-input-group">
                    <label class="sup-label">Subject of Inquiry</label>
                    <input type="text" id="supSubject" class="sup-field" required placeholder="e.g. Account Verification Issue">
                </div>
                <div class="sup-input-group">
                    <label class="sup-label">Detailed Transmission</label>
                    <textarea id="supMessage" class="sup-field" required rows="5" placeholder="Describe your technical or financial query..."></textarea>
                </div>
                <div class="sup-actions">
                    <button type="button" onclick="toggleSupportModal()" class="btn-sup btn-abort">Abort</button>
                    <button type="submit" id="supSubmitBtn" class="btn-sup btn-transmit">Transmit Inquiry</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/auth-guard.js"></script>
    <script>
        // ============================================================
        // SOVEREIGN WATCH ‚Äî Analog + Digital
        // ============================================================
        (function initWatch() {
            const clock    = document.getElementById('analogClock');
            const hHour    = document.getElementById('handHour');
            const hMin     = document.getElementById('handMin');
            const hSec     = document.getElementById('handSec');
            const digital  = document.getElementById('digitalClock');
            const dateEl   = document.getElementById('digitalDate');

            if (!clock) return;

            // Draw tick marks
            for (let i = 0; i < 60; i++) {
                const tick = document.createElement('div');
                tick.className = 'tick' + (i % 5 === 0 ? ' major' : '');
                const angle    = i * 6;
                const radius   = 45;
                const rad      = (angle - 90) * Math.PI / 180;
                const x        = 50 + radius * Math.cos(rad);
                const y        = 50 + radius * Math.sin(rad);
                tick.style.cssText = `position:absolute;left:${x}%;top:${y}%;transform:translate(-50%,-50%) rotate(${angle}deg);`;
                clock.appendChild(tick);
            }

            function tick() {
                const now     = new Date();
                const h       = now.getHours() % 12;
                const m       = now.getMinutes();
                const s       = now.getSeconds();
                const ms      = now.getMilliseconds();

                const sDeg    = (s + ms / 1000) * 6;
                const mDeg    = (m + s / 60) * 6;
                const hDeg    = (h + m / 60) * 30;

                if (hHour) hHour.style.transform = `translateX(-50%) rotate(${hDeg}deg)`;
                if (hMin)  hMin.style.transform  = `translateX(-50%) rotate(${mDeg}deg)`;
                if (hSec)  hSec.style.transform  = `translateX(-50%) rotate(${sDeg}deg)`;

                if (digital) {
                    const hh = String(now.getHours()).padStart(2,'0');
                    const mm = String(m).padStart(2,'0');
                    const ss = String(s).padStart(2,'0');
                    digital.textContent = `${hh}:${mm}:${ss}`;
                }
                if (dateEl) {
                    dateEl.textContent = now.toLocaleDateString('en-IN', { weekday:'short', day:'numeric', month:'short' });
                }
            }

            tick();
            setInterval(tick, 50); // smooth second hand
        })();

        // ============================================================
        // SUPPORT MODAL
        // ============================================================
        window.toggleSupportModal = () => {
            const m = document.getElementById('supportModal');
            if (m) m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
        };

        document.getElementById('supportForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('supSubmitBtn');
            btn.disabled = true; btn.textContent = 'TRANSMITTING...';
            try {
                const { data: { user } } = await supabase.auth.getUser();
                const { error } = await supabase.from('support_inquiries').insert({
                    user_id: user.id,
                    subject: document.getElementById('supSubject').value,
                    message: document.getElementById('supMessage').value
                });
                if (error) throw error;
                alert('Inquiry Transmitted. Oversight will review shortly.');
                toggleSupportModal(); e.target.reset();
            } catch (err) { alert('Error: ' + err.message); }
            finally { btn.disabled = false; btn.textContent = 'Transmit Inquiry'; }
        });

        // ============================================================
        // MOOD REFRESHER ‚Äî Founder & Investor quotes
        // ============================================================
        const founderQuotes = [
            { q: "The only way to do great work is to love what you do.", a: "Steve Jobs" },
            { q: "Your most unhappy customers are your greatest source of learning.", a: "Bill Gates" },
            { q: "It's not about ideas. It's about making ideas happen.", a: "Scott Belsky" },
            { q: "The secret to getting ahead is getting started.", a: "Mark Twain" },
            { q: "Done is better than perfect.", a: "Sheryl Sandberg" },
            { q: "Chase the vision, not the money; the money will end up following you.", a: "Tony Hsieh" },
            { q: "The best way to predict the future is to create it.", a: "Peter Drucker" },
            { q: "Risk more than others think is safe. Dream more than others think is practical.", a: "Howard Schultz" },
            { q: "Success is not final, failure is not fatal ‚Äî it is the courage to continue that counts.", a: "Winston Churchill" },
            { q: "The entrepreneur always searches for change, responds to it, and exploits it as an opportunity.", a: "Peter Drucker" },
            { q: "Opportunities don't happen. You create them.", a: "Chris Grosser" },
            { q: "A ship in harbor is safe, but that's not what ships are built for.", a: "John Shedd" },
        ];

        const investorQuotes = [
            { q: "Price is what you pay. Value is what you get.", a: "Warren Buffett" },
            { q: "The stock market is a device for transferring money from the impatient to the patient.", a: "Warren Buffett" },
            { q: "In investing, what is comfortable is rarely profitable.", a: "Robert Arnott" },
            { q: "The four most dangerous words in investing are: this time it's different.", a: "Sir John Templeton" },
            { q: "Know what you own, and know why you own it.", a: "Peter Lynch" },
            { q: "It's not whether you're right or wrong, but how much money you make when you're right.", a: "George Soros" },
            { q: "The time to buy is when there's blood in the streets.", a: "Baron Rothschild" },
            { q: "An investment in knowledge pays the best interest.", a: "Benjamin Franklin" },
            { q: "Don't look for the needle in the haystack. Just buy the haystack.", a: "John Bogle" },
            { q: "The biggest risk is not taking any risk.", a: "Mark Zuckerberg" },
            { q: "Be fearful when others are greedy, and greedy when others are fearful.", a: "Warren Buffett" },
            { q: "Wide diversification is only required when investors do not understand what they are doing.", a: "Warren Buffett" },
        ];

        let lastFounderIdx = -1, lastInvestorIdx = -1;

        function getRandomQuote(arr, lastIdx) {
            let idx;
            do { idx = Math.floor(Math.random() * arr.length); } while (idx === lastIdx && arr.length > 1);
            return { quote: arr[idx], idx };
        }

        function refreshMood() {
            const { quote, idx } = getRandomQuote(founderQuotes, lastFounderIdx);
            lastFounderIdx = idx;
            const q = document.getElementById('moodQuote');
            const a = document.getElementById('moodAuthor');
            if (q) { q.style.opacity = '0'; setTimeout(() => { q.textContent = `"${quote.q}"`; q.style.opacity = '1'; }, 200); }
            if (a) { a.style.opacity = '0'; setTimeout(() => { a.textContent = `‚Äî ${quote.a}`; a.style.opacity = '1'; }, 200); }
        }

        function refreshMoodInvestor() {
            const { quote, idx } = getRandomQuote(investorQuotes, lastInvestorIdx);
            lastInvestorIdx = idx;
            const q = document.getElementById('moodQuoteInvestor');
            const a = document.getElementById('moodAuthorInvestor');
            if (q) { q.style.opacity = '0'; setTimeout(() => { q.textContent = `"${quote.q}"`; q.style.opacity = '1'; }, 200); }
            if (a) { a.style.opacity = '0'; setTimeout(() => { a.textContent = `‚Äî ${quote.a}`; a.style.opacity = '1'; }, 200); }
        }

        // Add transition to quote elements
        document.addEventListener('DOMContentLoaded', () => {
            ['moodQuote','moodAuthor','moodQuoteInvestor','moodAuthorInvestor'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.transition = 'opacity .2s ease';
            });
            refreshMood();
            refreshMoodInvestor();
        });

        // ============================================================
        // INIT
        // ============================================================
        async function initializeDashboardUX() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return;

            const { data: profile } = await supabase.from('users').select('*').eq('id', user.id).maybeSingle();
            if (!profile) return;

            const role = profile.role;

            if (role === 'investor') {
                document.getElementById('investorPortfolioBtn')?.classList.remove('hidden');
            }
            if (role === 'entrepreneur') {
                document.getElementById('submitProposalBtn')?.classList.remove('hidden');
                document.getElementById('entrepreneurPortfolioBtn')?.classList.remove('hidden');
                const qaBtn = document.getElementById('qaSubmitBtn');
                if (qaBtn) qaBtn.style.display = 'inline-flex';
            }
        }

        window.addEventListener('load', initializeDashboardUX);

        // ============================================================
        // TAB SWITCH ‚Äî fix event passing
        // ============================================================
        window.switchEntrepreneurTab = function(tab, e) {
            document.querySelectorAll('#entrepreneurDashboard .tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#entrepreneurDashboard .tab-content').forEach(c => c.classList.remove('active'));
            if (e && e.currentTarget) e.currentTarget.classList.add('active');
            const tc = document.getElementById(`${tab}-tab`);
            if (tc) tc.classList.add('active');
        };

        window.switchInvestorTab = function(tab, e) {
            document.querySelectorAll('#investorDashboard .tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#investorDashboard .tab-content').forEach(c => c.classList.remove('active'));
            if (e && e.currentTarget) e.currentTarget.classList.add('active');
            const tc = document.getElementById(`${tab}-tab`);
            if (tc) tc.classList.add('active');
        };
    </script>
</body>
</html>